name: Gemini Auto Fixer
on:
  issues:
    types: [opened]

permissions:
  contents: write
  pull-requests: write
  issues: read

jobs:
  fix:
    # タイトルに /fix が含まれる時だけ実行
    if: contains(github.event.issue.title, '/fix')
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run Gemini AI Agent
        uses: google-github-actions/run-gemini-cli@main
        with:
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          # 引用符で囲み、改行エラーを防ぐ記述に変更
          prompt: >
            You are a professional TypeScript and Next.js developer.
            Please fix the source code based on the following Issue.
            
            Requirements:
            1. Create a new branch for the fix.
            2. After fixing the code, open a Pull Request.
            3. The PR title and description should be automatically generated by you, summarizing the changes clearly in Japanese.
            4. In the PR description, include "Closes #${{ github.event.issue.number }}" to automatically close the issue when merged.

            Issue Title: "${{ github.event.issue.title }}"
            Issue Body: "${{ github.event.issue.body }}"
